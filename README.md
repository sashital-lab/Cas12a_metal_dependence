# Cas12a_metal_dependence
Scripts used for analysis of Cas12a metal-dependent specificity

# General outline for analysis of plasmid library cleavage
The original plasmid library contained a 24 nt sequence corresponding to a potential Cas12a target in the gene L or gene W region of the lambda-vir genome. Each 24 nt sequence, including the TTTN PAM and the 20-nt target, was variable within the library to encompass all 1-nt deletions, 1-nt mutations, or 2-nt mutations. In addition, five unrelated sequences were introduced into the library as spike-in samples for normalization. The experiment yielded fastq files containing sequences from controls (no Cas12a cleavage, i.e. the original library), the supercoiled fraction, or the nicked fraction.

The first step of analysis was to determine the number of times that each potential mutant target sequence and spike-in sequence occurred in each sample. This was accomplished using the script "sequence_counts.py" on all samples (i.e. controls, supercoiled, and nicked).

For the supercoiled fraction, the number of reads for each sequence in each experimental sample was first normalized to the total number of reads in the sample to determine the fraction of total reads (FTR). FTR for each sequence in the experimental samples were then normalized to FTR for the same sequence in the corresponding controls. This normalization ensures that variations in sequence distribution in the original library are accounted for. Finally, a normalization factor was determined by averaging the normalized FTR for the spike-in samples. Each mutant target sequence was divided by the normalization factor to determine the abundance of the sequence in the sample relative to a sequence that should not have been specifically cleaved by Cas12a. This normalization was accomplished using the script "normalize_SC_to_control_and_spikein.py" on all supercoiled samples and yields an abundance value for each sequence in the supercoiled fraction. 

For the nicked fraction samples, the FTR and normalization to control was performed as for the supercoiled fraction using the script "normalize_nicked_to_control.py". Triplicate output files from this script were merged using "merge_files.py". The merged output was then used as input for the script "nicked_normalize_to_fraction_cleaved.py", which uses the fraction of the plasmid library that was nicked at each Mg2+ concentration as a normalization factor to multiply by the normalized FTR. This yields an abundance value for each sequence in the nicked fraction. 

The sequences containing a single deletion could be extracted from the files generated by the above scripts using the script "single_nt_del.py". This script reads in a file containing all single-nt deletion sequences in order and outputs a file with the abundance values for each of those sequences in the same order. 

# General outline for generation of heatmaps
This scripts described above can output files in which the values from all replicates are averaged. The files with the average abundance values at each Mg2+ concentration were used to generate the one-deletion sequence file and both files were input to the script "heatmaps_1and2MM_1del_individual.py" to generate heatmaps. The resulting pngs were compiled into an animated gif using "animated_gif.py".

The scripts described above can also be used to output files in which each replicate is output. These files from each Mg2+ concentration sample can be merged using "merge_files.py" to generate files in which all replicates for each Cas12a/gene pair at each Mg2+ are merged into a single file. These files are useful for generating individual graphs of slopes for the SC fraction or nicked fraction.

The means for the normalized supercoiled and nicked abundance scores were  used as input files to determine the fraction of DNA that was linearized and the slope of those values versus Mg2+ concentration. This was accomplished using the script "slopes_linear_fraction.py", followed by extraction of single-nucleotide deletion sequences. The output of these scripts was used as input for the script "heatmaps_1and2MM_and1del_slopes.py" to generate the slope heatmaps.
